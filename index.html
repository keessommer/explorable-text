<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <Style>
        body{
            color: white;
            background-color : black;
            overflow-y: hidden; 
            overflow-x: hidden; 
        }
        .description{
            display: block;
            font-size: 16pt;
            transition: 1s;
            color: black;
            max-width: 300px;
        }
        #container {
            cursor: grab;
            overflow: auto;
            height: 100vh; 
            overflow: auto; 
            padding: 0 2rem
        }

        /* .item {

            align-items: center;
            display: flex;
            justify-content: center;


            border: 1px solid #cbd5e0;
            font-size: 2.25rem;
            height: 12rem;
            margin: 2rem 0;
            width: 200rem;
        } */
    </Style>
</head>
<body>
    <div id="container">
        <div class="main"></div>
    </div>
    <script>
        const nodes = {
            rooms: {
                square : {
                    name: 'square',
                    description: 'Evening twilight turns the town square golden. In the center stands an old tree, while buildings encircle its periphery.',
                    x: '50vw',
                    y: '50vh',
                    objects: [
                        {name: 'tree', x : '0px', y : '-300px'},
                        {name: 'buildings', x : '0px', y : '10px'},
                    ]
                },
            },
            objects: {
                tree : {
                    name: 'tree',
                    description: 'The old tree stands tall. Its roots break through the cobblestone. Pigeons flock around the base.',
                },
                buildings : {
                    name: 'buildings',
                    description: 'Houses and apartments stand abandoned. On the ground floor storefronts lie emptied.',
                },
            }
        }

        const mainHtml = document.querySelector('.main');
        const initialRoom = nodes.rooms.square;
        initialRoom.objects.forEach(
            object => {
                const pos = initialRoom.description.indexOf(object.name);
                const nameLength = object.name.length;
                initialRoom.description = initialRoom.description.slice(0, pos) 
                + '<a onClick = "clickWord(event)">'
                + initialRoom.description.slice(pos, pos+nameLength)
                + '</a>' + initialRoom.description.slice(pos+nameLength);
            }
        );
        mainHtml.innerHTML += addNodeAsP(initialRoom, initialRoom.x, initialRoom.y);
        const initialRoomEl = document.querySelector(`#description${initialRoom.name}`);
        initialRoom.objects.forEach(
            object => {
                initialRoomEl.innerHTML += addNodeAsP(nodes.objects[object.name], object.x, object.y);
            }
        );
        makeVisible(initialRoomEl, initialRoom.x, initialRoom.y);
        function addNodeAsP(node){
            return `<div class="description" id="description${node.name}" 
            >${node['description']}</div>`;
        }

        function makeVisible(el, x, y){
            console.log(x, y)
            el.style = `color: white; transform: translate(${x}, ${y})`;
        }

        function clickWord(input){
            const el = document.querySelector(`#description${input.target.text}`);
            const node = initialRoom.objects.find( entry => entry.name == input.target.text);
            makeVisible(el, node.x, node.y);
        }

        document.addEventListener('DOMContentLoaded', function () {
            const ele = document.getElementById('container');
            ele.style.cursor = 'grab';

            let pos = { top: 0, left: 0, x: 0, y: 0 };

            const mouseDownHandler = function (e) {
                ele.style.cursor = 'grabbing';
                ele.style.userSelect = 'none';

                pos = {
                    left: ele.scrollLeft,
                    top: ele.scrollTop,
                    // Get the current mouse position
                    x: e.clientX,
                    y: e.clientY,
                };

                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);
            };

            const mouseMoveHandler = function (e) {
                const dx = e.clientX - pos.x;
                const dy = e.clientY - pos.y;
                ele.scrollTop = pos.top - dy;
                ele.scrollLeft = pos.left - dx;
            };

            const mouseUpHandler = function () {
                ele.style.cursor = 'grab';
                ele.style.removeProperty('user-select');
                document.removeEventListener('mousemove', mouseMoveHandler);
                document.removeEventListener('mouseup', mouseUpHandler);
            };

            ele.addEventListener('mousedown', mouseDownHandler);
        });
        
    </script>
</body>

</html>